<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Favoritos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
    h1 { text-align: center; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background: white;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
      position: relative;
    }
    .card img {
      width: 100%;
      border-radius: 8px;
    }
    .card span {
      display: block;
      margin-top: 8px;
      font-weight: bold;
    }
    .card button {
      margin-top: 8px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    .card input[type="checkbox"] {
      position: absolute;
      top: 10px;
      left: 10px;
      transform: scale(1.5);
    }
    .actions {
      text-align: center;
      margin: 20px 0;
    }
    .actions button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
    }
    .mensagem-final {
      margin-top: 40px;
      text-align: center;
      font-weight: bold;
      color: red;
    }
  </style>
</head>
<body>
<h1>Meus Favoritos ‚ù§Ô∏è</h1>
<div class="actions">
  <button onclick="selecionarTudo()">‚úîÔ∏è Selecionar tudo</button>
  <button onclick="limparSelecao()">‚ùå Limpar sele√ß√£o</button>
  <button onclick="compartilharSelecionadas()">üîó Compartilhar selecionadas</button>
  <button onclick="gerarPDFSelecionadas()">üìÑ Gerar PDF</button>
  <button onclick="removerSelecionadas()">üíî Remover selecionadas</button>
</div>
<div class="grid" id="favoritos"></div>
<p class="mensagem-final">
  ATEN√á√ÉO! Encaminhe suas imagens favoritas antes de fechar o navegador.<br>
  Ao fechar o navegador voc√™ perder√° seus favoritos.
</p>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
  const container = document.getElementById('favoritos');
  let favoritos = JSON.parse(localStorage.getItem('favoritos')) || [];
  favoritos.sort((a, b) => {
    const nomeA = a.split('/').pop().replace(/\.(jpg|jpeg|png)$/i, '').replace(/[-_\s]*\d+$/, '').toLowerCase();
    const nomeB = b.split('/').pop().replace(/\.(jpg|jpeg|png)$/i, '').replace(/[-_\s]*\d+$/, '').toLowerCase();
    return nomeA.localeCompare(nomeB);
  });

  function carregarFavoritos() {
    container.innerHTML = '';
    if (favoritos.length === 0) {
      container.innerHTML = "<p style='text-align:center;'>Adicione modelos aos favoritos e veja todos os seus modelos aqui.</p>";
      return;
    }
    favoritos.forEach((src, i) => {
      const nome = src.split('/').pop().replace(/\.(jpg|jpeg|png)$/i, '').replace(/[-_\s]*\d+$/, '');
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <input type="checkbox" class="selecao" value="${src}">
        <img src="${src}" alt="${nome}">
        <span>${nome}</span>
        <button onclick="removerFavorito('${src}')">üíî</button>
      `;
      container.appendChild(div);
    });
  }

  function removerFavorito(src) {
    favoritos = favoritos.filter(f => f !== src);
    localStorage.setItem('favoritos', JSON.stringify(favoritos));
    carregarFavoritos();
  }

  function selecionadas() {
    return Array.from(document.querySelectorAll('.selecao:checked')).map(cb => cb.value);
  }

  function selecionarTudo() {
    document.querySelectorAll('.selecao').forEach(cb => cb.checked = true);
  }

  function limparSelecao() {
    document.querySelectorAll('.selecao').forEach(cb => cb.checked = false);
  }

  function removerSelecionadas() {
    const selecionadasList = selecionadas();
    if (selecionadasList.length === 0) return alert("Nenhuma imagem selecionada.");
    favoritos = favoritos.filter(f => !selecionadasList.includes(f));
    localStorage.setItem('favoritos', JSON.stringify(favoritos));
    carregarFavoritos();
  }

  function compartilharSelecionadas() {
    const selecionadasList = selecionadas();
    if (selecionadasList.length === 0) return alert("Nenhuma imagem selecionada.");
    alert("O compartilhamento direto de v√°rias imagens ainda ser√° ativado. Por enquanto, copie ou baixe as imagens manualmente.");
  }

  async function gerarPDFSelecionadas() {
    const {{ jsPDF }} = window.jspdf;
    const selecionadasList = selecionadas();
    if (selecionadasList.length === 0) return alert("Nenhuma imagem selecionada.");
    const pdf = new jsPDF({ orientation: 'portrait', unit: 'cm', format: [21, 21] });
    for (let i = 0; i < selecionadasList.length; i++) {
      const src = selecionadasList[i];
      const nome = src.split('/').pop().replace(/\.(jpg|jpeg|png)$/i, '').replace(/[-_\s]*\d+$/, '');
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.src = src;
      await img.decode();
      const canvas = await html2canvas(img, { backgroundColor: null, useCORS: true });
      const imgData = canvas.toDataURL("image/jpeg", 1.0);
      if (i > 0) pdf.addPage();
      pdf.addImage(imgData, 'JPEG', 1.75, 1.75, 17.5, 17.5);
      pdf.setFontSize(14);
      pdf.setTextColor(0, 0, 0);
      pdf.setFillColor(255, 255, 255);
      pdf.rect(5.5, 19, 10, 1, 'F');
      pdf.text(nome, 6, 19.7);
      pdf.setDrawColor(1, 185, 181);
      pdf.setLineWidth(0.15);
      pdf.line(11, 20.5, 21 - 1.5, 20.5);
      pdf.text(`${i + 1}`, 21 - 1.8, 21 - 2.2);
    }
    pdf.save("favoritos-catalogo.pdf");
  }

  carregarFavoritos();
</script>
</body>
</html>