<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Favoritos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 0; background: #f4f4f4; }
    .top-bar {
      position: sticky;
      top: 0;
      background: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      z-index: 1000;
      flex-wrap: wrap;
      gap: 10px;
    }
    .btn {
      background: #01b9b5;
      color: white;
      text-decoration: none;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 20px;
      padding: 20px;
    }
    @media (min-width: 768px) {
      .grid { grid-template-columns: repeat(3, 1fr); }
    }
    .card {
      background: white;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
      position: relative;
    }
    .card img { width: 100%; border-radius: 8px; }
    .card span { display: block; margin-top: 8px; font-weight: bold; }
    .checkbox-select {
      position: absolute;
      top: 10px;
      left: 10px;
      transform: scale(1.5);
    }
    .heart-remove {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: red;
    }
    .mensagem-vazia {
      text-align: center;
      font-size: 18px;
      margin-top: 40px;
    }
    .aviso {
      margin-top: 40px;
      font-size: 14px;
      text-align: center;
      color: red;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <a href="index.html" class="btn">&larr; Voltar</a>
    <button class="btn" onclick="baixarSelecionadas()">ðŸ“¥ Baixar selecionadas</button>
    <button class="btn" onclick="removerSelecionadas()">ðŸ’” Remover selecionadas</button>
    <button class="btn" onclick="selecionarTodos()">Selecionar todos</button>
    <button class="btn" onclick="desmarcarTodos()">Desmarcar todos</button>
  </div>
  <div class="grid" id="galeria"></div>
  <p class="mensagem-vazia" id="mensagem"></p>
  <p class="aviso">ATENÃ‡ÃƒO! Encaminhe suas imagens favoritas antes de fechar o navegador. Ao fechar o navegador vocÃª perderÃ¡ seus favoritos.</p>

<script>
function limparNome(nome) {
  return nome
    .replace(/\.[^/.]+$/, '')            // remove extensÃ£o
    .replace(/\s*[(ï¼ˆ]?\d+[)ï¼‰]?$/, '')   // remove nÃºmeros e (1), (2), etc
    .trim();
}

function carregarFavoritos() {
  const container = document.getElementById('galeria');
  const favoritos = JSON.parse(localStorage.getItem('favoritos')) || [];
  const mensagem = document.getElementById('mensagem');
  container.innerHTML = '';

  if (favoritos.length === 0) {
    mensagem.textContent = "Adicione modelos aos favoritos e veja todos os seus modelos aqui.";
    return;
  }

  mensagem.textContent = "";

  const favoritosOrdenados = favoritos.slice().sort((a, b) => {
    const nomeA = decodeURIComponent(a.split('/').pop()).toLowerCase();
    const nomeB = decodeURIComponent(b.split('/').pop()).toLowerCase();
    return nomeA.localeCompare(nomeB);
  });

  favoritosOrdenados.forEach(src => {
    const card = document.createElement('div');
    card.className = 'card';

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.className = 'checkbox-select';
    checkbox.value = src;

    const btn = document.createElement('button');
    btn.className = 'heart-remove';
    btn.innerText = 'ðŸ’”';
    btn.onclick = () => removerFavorito(src);

    const img = document.createElement('img');
    img.src = src;

    const nomeOriginal = decodeURIComponent(src.split('/').pop());
    const nomeLimpo = limparNome(nomeOriginal);
    const nome = document.createElement('span');
    nome.innerText = nomeLimpo;

    card.appendChild(checkbox);
    card.appendChild(btn);
    card.appendChild(img);
    card.appendChild(nome);
    container.appendChild(card);
  });
}

function removerFavorito(src) {
  let favoritos = JSON.parse(localStorage.getItem('favoritos')) || [];
  favoritos = favoritos.filter(f => f !== src);
  localStorage.setItem('favoritos', JSON.stringify(favoritos));
  carregarFavoritos();
}

function baixarSelecionadas() {
  const selecionadas = Array.from(document.querySelectorAll('.checkbox-select:checked')).map(cb => cb.value);
  if (selecionadas.length === 0) return alert("Nenhuma imagem selecionada.");
  selecionadas.forEach(src => {
    const link = document.createElement('a');
    link.href = src;
    link.download = src.split('/').pop();
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });
}

function removerSelecionadas() {
  const selecionadas = Array.from(document.querySelectorAll('.checkbox-select:checked')).map(cb => cb.value);
  if (selecionadas.length === 0) return alert("Nenhuma imagem selecionada.");
  let favoritos = JSON.parse(localStorage.getItem('favoritos')) || [];
  selecionadas.forEach(src => {
    favoritos = favoritos.filter(f => f !== src);
  });
  localStorage.setItem('favoritos', JSON.stringify(favoritos));
  carregarFavoritos();
}

function selecionarTodos() {
  document.querySelectorAll('.checkbox-select').forEach(cb => cb.checked = true);
}

function desmarcarTodos() {
  document.querySelectorAll('.checkbox-select').forEach(cb => cb.checked = false);
}

carregarFavoritos();
</script>
</body>
</html>
